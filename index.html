<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Mastery Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .mode-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .profile-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .profile-card {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .profile-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .profile-card.selected {
            border-color: #667eea;
            background: #f7fafc;
        }

        .profile-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .profile-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .profile-desc {
            font-size: 0.9em;
            color: #718096;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            padding: 20px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .metric-card.positive {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
        }

        .metric-card.negative {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .metric-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .input-section {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.4em;
            color: #2d3748;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .help-icon {
            cursor: help;
            color: #667eea;
            font-size: 0.9em;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            width: 100%;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
        }

        canvas {
            max-width: 100%;
        }

        .score-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .score-card {
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .score-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .score-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .scenario-box {
            background: #fff5e6;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .scenario-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 10px;
        }

        .scenario-text {
            color: #78350f;
            line-height: 1.6;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .tooltip {
            background: #2d3748;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            margin-top: 5px;
            display: none;
        }

        .input-group:hover .tooltip {
            display: block;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .metric-value {
                font-size: 2em;
            }

            .mode-toggle {
                flex-direction: column;
            }
        }

        .explanation-box {
            background: #e6f3ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
            color: #1e3a8a;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .animate-number {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Financial Mastery Simulator</h1>
        <p class="subtitle">Make strategic decisions and watch how they impact your financial future</p>

        <!-- Mode Toggle -->
        <div class="mode-toggle">
            <button class="mode-btn active" onclick="setMode('learning')">üìö Learning Mode</button>
            <button class="mode-btn" onclick="setMode('game')">üéÆ Game Mode</button>
        </div>

        <!-- Profile Selector -->
        <div class="input-section">
            <div class="section-title">üë§ Choose Your Profile</div>
            <div class="profile-selector">
                <div class="profile-card" onclick="selectProfile('freelancer')">
                    <div class="profile-icon">üíº</div>
                    <div class="profile-title">Freelancer</div>
                    <div class="profile-desc">Variable income, low overhead</div>
                </div>
                <div class="profile-card" onclick="selectProfile('agency')">
                    <div class="profile-icon">üè¢</div>
                    <div class="profile-title">Agency Owner</div>
                    <div class="profile-desc">Team management, higher expenses</div>
                </div>
                <div class="profile-card" onclick="selectProfile('ecommerce')">
                    <div class="profile-icon">üõí</div>
                    <div class="profile-title">E-commerce</div>
                    <div class="profile-desc">Inventory costs, scaling potential</div>
                </div>
                <div class="profile-card" onclick="selectProfile('employee')">
                    <div class="profile-icon">üë®‚Äçüíº</div>
                    <div class="profile-title">Employee</div>
                    <div class="profile-desc">Stable income, limited control</div>
                </div>
            </div>
        </div>

        <!-- Key Metrics Dashboard -->
        <div class="dashboard">
            <div class="metric-card" id="profitCard">
                <div class="metric-label">Monthly Profit/Loss</div>
                <div class="metric-value animate-number" id="monthlyProfit">$0</div>
                <div class="metric-change" id="profitChange">--</div>
            </div>
            <div class="metric-card warning" id="runwayCard">
                <div class="metric-label">Cash Runway</div>
                <div class="metric-value animate-number" id="runway">-- months</div>
                <div class="metric-change">Time until $0</div>
            </div>
            <div class="metric-card" id="breakevenCard">
                <div class="metric-label">Break-Even Point</div>
                <div class="metric-value animate-number" id="breakeven">$0/mo</div>
                <div class="metric-change">Minimum needed</div>
            </div>
            <div class="metric-card" id="yearlyCard">
                <div class="metric-label">Yearly Projection</div>
                <div class="metric-value animate-number" id="yearlyProfit">$0</div>
                <div class="metric-change">12-month outlook</div>
            </div>
        </div>

        <!-- Scenario Box (Game Mode Only) -->
        <div class="scenario-box" id="scenarioBox" style="display:none;">
            <div class="scenario-title">üéØ Current Challenge</div>
            <div class="scenario-text" id="scenarioText">Loading scenario...</div>
        </div>

        <!-- Income Section -->
        <div class="input-section">
            <div class="section-title">üíµ Business Income Streams</div>
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">
                        Primary Revenue
                        <span class="help-icon" title="Main source of business income">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="primaryRevenue" value="5000" oninput="calculate()">
                    <div class="explanation-box">Your main income source (e.g., client work, product sales)</div>
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Secondary Revenue
                        <span class="help-icon" title="Additional income streams">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="secondaryRevenue" value="0" oninput="calculate()">
                    <div class="explanation-box">Passive income, side projects, affiliate earnings</div>
                </div>
            </div>
        </div>

        <!-- Business Expenses Section -->
        <div class="input-section">
            <div class="section-title">üè¢ Business Operating Expenses</div>
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">
                        Fixed Costs (Rent, Software, etc.)
                        <span class="help-icon" title="Regular monthly business expenses">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="fixedCosts" value="1000" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Variable Costs (Marketing, Freelancers)
                        <span class="help-icon" title="Costs that scale with revenue">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="variableCosts" value="500" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Payroll / Contractor Costs
                        <span class="help-icon" title="Team salaries and payments">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="payroll" value="0" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Debt Payments (Loans, Credit)
                        <span class="help-icon" title="Monthly debt obligations">‚ÑπÔ∏è</span>
                    </label>
                    <input type="number" class="input-field" id="debtPayments" value="0" oninput="calculate()">
                    <div class="explanation-box">‚ö†Ô∏è Debt reduces cash flow and increases risk</div>
                </div>
            </div>
        </div>

        <!-- Personal Expenses Section -->
        <div class="input-section">
            <div class="section-title">üè† Personal Living Expenses</div>
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">
                        Housing (Rent/Mortgage)
                    </label>
                    <input type="number" class="input-field" id="housing" value="1500" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Food & Groceries
                    </label>
                    <input type="number" class="input-field" id="food" value="600" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Transportation
                    </label>
                    <input type="number" class="input-field" id="transportation" value="300" oninput="calculate()">
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Lifestyle (Entertainment, Shopping)
                    </label>
                    <input type="range" class="slider" id="lifestyle" min="0" max="2000" value="400" oninput="updateLifestyleValue(); calculate()">
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span>$0</span>
                        <span id="lifestyleValue">$400</span>
                        <span>$2000</span>
                    </div>
                    <div class="explanation-box">üí° Lifestyle inflation is a silent business killer</div>
                </div>
            </div>
        </div>

        <!-- Taxes & Savings -->
        <div class="input-section">
            <div class="section-title">üí∞ Taxes & Savings</div>
            <div class="grid-2">
                <div class="input-group">
                    <label class="input-label">
                        Tax Rate (%)
                    </label>
                    <input type="range" class="slider" id="taxRate" min="0" max="50" value="25" oninput="updateTaxValue(); calculate()">
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span>0%</span>
                        <span id="taxValue">25%</span>
                        <span>50%</span>
                    </div>
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Monthly Savings Goal
                    </label>
                    <input type="number" class="input-field" id="savings" value="500" oninput="calculate()">
                    <div class="explanation-box">Building reserves = business resilience</div>
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Reinvestment Rate (%)
                    </label>
                    <input type="range" class="slider" id="reinvestment" min="0" max="100" value="20" oninput="updateReinvestmentValue(); calculate()">
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <span>0%</span>
                        <span id="reinvestmentValue">20%</span>
                        <span>100%</span>
                    </div>
                    <div class="explanation-box">üìà Reinvesting profits accelerates growth</div>
                </div>
                <div class="input-group">
                    <label class="input-label">
                        Current Cash Reserves
                    </label>
                    <input type="number" class="input-field" id="cashReserves" value="10000" oninput="calculate()">
                </div>
            </div>
        </div>

        <!-- Score Section -->
        <div class="score-section">
            <div class="score-card">
                <div class="score-title">üéØ Financial Stability Score</div>
                <div class="score-bar">
                    <div class="score-fill" id="stabilityScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="score-card">
                <div class="score-title">üöÄ Growth Potential Score</div>
                <div class="score-bar">
                    <div class="score-fill" id="growthScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="score-card">
                <div class="score-title">‚ö° Efficiency Score</div>
                <div class="score-bar">
                    <div class="score-fill" id="efficiencyScore" style="width: 0%">0%</div>
                </div>
            </div>
            <div class="score-card">
                <div class="score-title">üèÜ Lifestyle Affordability</div>
                <div class="score-bar">
                    <div class="score-fill" id="lifestyleScore" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="chart-container">
            <div class="section-title">üìä 12-Month Cash Flow Projection</div>
            <canvas id="cashflowChart"></canvas>
        </div>

        <!-- Learning Insights -->
        <div class="input-section" id="learningInsights">
            <div class="section-title">üí° Key Learning Insights</div>
            <div id="insightsContent">
                <div class="explanation-box" style="margin-bottom:15px;">
                    <strong>Why Profit ‚â† Cash:</strong> You can be profitable on paper but run out of money. This happens when revenue is tied up in receivables, inventory, or delayed payments. Always track cash flow, not just profit.
                </div>
                <div class="explanation-box" style="margin-bottom:15px;">
                    <strong>Lifestyle Inflation Kills Businesses:</strong> As income grows, personal expenses often grow faster. This reduces your business safety net and limits reinvestment capacity. Keep lifestyle costs in check.
                </div>
                <div class="explanation-box" style="margin-bottom:15px;">
                    <strong>How Debt Impacts Survivability:</strong> Debt payments are fixed costs that don't care about your revenue fluctuations. High debt reduces runway and increases stress during slow months.
                </div>
                <div class="explanation-box">
                    <strong>Reinvestment Changes Growth:</strong> Businesses that reinvest profits into marketing, tools, or team capacity grow faster. But over-reinvesting without reserves is risky. Balance is key.
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="calculate()">üîÑ Recalculate</button>
            <button class="btn btn-secondary" onclick="resetSimulator()">‚Ü∫ Reset</button>
            <button class="btn btn-secondary" onclick="nextScenario()">‚û°Ô∏è Next Scenario</button>
        </div>
    </div>

    <script>
        // Global State
        let currentMode = 'learning';
        let currentProfile = 'freelancer';
        let scenarioIndex = 0;

        // Profile Templates
        const profiles = {
            freelancer: {
                primaryRevenue: 5000,
                secondaryRevenue: 500,
                fixedCosts: 200,
                variableCosts: 300,
                payroll: 0,
                debtPayments: 0
            },
            agency: {
                primaryRevenue: 20000,
                secondaryRevenue: 2000,
                fixedCosts: 3000,
                variableCosts: 2000,
                payroll: 8000,
                debtPayments: 500
            },
            ecommerce: {
                primaryRevenue: 15000,
                secondaryRevenue: 1000,
                fixedCosts: 2000,
                variableCosts: 5000,
                payroll: 2000,
                debtPayments: 800
            },
            employee: {
                primaryRevenue: 6000,
                secondaryRevenue: 0,
                fixedCosts: 0,
                variableCosts: 0,
                payroll: 0,
                debtPayments: 300
            }
        };

        // Scenarios for Game Mode
        const scenarios = [
            {
                title: "The Unexpected Opportunity",
                text: "A client offers you a $10,000 project, but you need to hire a contractor for $3,000 and invest $2,000 in tools. Your cash reserves are low. Do you take it?",
                impact: "This tests your ability to evaluate opportunity cost vs risk."
            },
            {
                title: "Lifestyle Temptation",
                text: "Your income just doubled! You're considering upgrading your apartment (+$800/mo) and buying a new car (+$500/mo). Can you afford it long-term?",
                impact: "Lifestyle inflation can destroy your runway even when income is high."
            },
            {
                title: "Economic Downturn",
                text: "A recession hits. Your revenue drops by 40% for the next 6 months. Can you survive with current expenses?",
                impact: "This reveals whether you have enough runway and flexibility."
            },
            {
                title: "Reinvestment Decision",
                text: "You have $5,000 extra this month. Invest in marketing, save it, or increase personal spending?",
                impact: "Reinvestment accelerates growth, but reserves protect against shocks."
            }
        ];

        // Set Mode
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (mode === 'game') {
                document.getElementById('scenarioBox').style.display = 'block';
                document.getElementById('learningInsights').style.display = 'none';
                loadScenario();
            } else {
                document.getElementById('scenarioBox').style.display = 'none';
                document.getElementById('learningInsights').style.display = 'block';
            }
        }

        // Select Profile
        function selectProfile(profile) {
            currentProfile = profile;
            document.querySelectorAll('.profile-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.profile-card').classList.add('selected');
            
            // Load profile defaults
            const template = profiles[profile];
            document.getElementById('primaryRevenue').value = template.primaryRevenue;
            document.getElementById('secondaryRevenue').value = template.secondaryRevenue;
            document.getElementById('fixedCosts').value = template.fixedCosts;
            document.getElementById('variableCosts').value = template.variableCosts;
            document.getElementById('payroll').value = template.payroll;
            document.getElementById('debtPayments').value = template.debtPayments;
            
            calculate();
        }

        // Update Slider Values
        function updateLifestyleValue() {
            document.getElementById('lifestyleValue').textContent = '$' + document.getElementById('lifestyle').value;
        }

        function updateTaxValue() {
            document.getElementById('taxValue').textContent = document.getElementById('taxRate').value + '%';
        }

        function updateReinvestmentValue() {
            document.getElementById('reinvestmentValue').textContent = document.getElementById('reinvestment').value + '%';
        }

        // Main Calculation Engine
        function calculate() {
            // Get all inputs
            const primaryRevenue = parseFloat(document.getElementById('primaryRevenue').value) || 0;
            const secondaryRevenue = parseFloat(document.getElementById('secondaryRevenue').value) || 0;
            const fixedCosts = parseFloat(document.getElementById('fixedCosts').value) || 0;
            const variableCosts = parseFloat(document.getElementById('variableCosts').value) || 0;
            const payroll = parseFloat(document.getElementById('payroll').value) || 0;
            const debtPayments = parseFloat(document.getElementById('debtPayments').value) || 0;
            const housing = parseFloat(document.getElementById('housing').value) || 0;
            const food = parseFloat(document.getElementById('food').value) || 0;
            const transportation = parseFloat(document.getElementById('transportation').value) || 0;
            const lifestyle = parseFloat(document.getElementById('lifestyle').value) || 0;
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const savings = parseFloat(document.getElementById('savings').value) || 0;
            const reinvestmentRate = parseFloat(document.getElementById('reinvestment').value) || 0;
            const cashReserves = parseFloat(document.getElementById('cashReserves').value) || 0;

            // Calculate totals
            const totalRevenue = primaryRevenue + secondaryRevenue;
            const totalBusinessExpenses = fixedCosts + variableCosts + payroll + debtPayments;
            const totalPersonalExpenses = housing + food + transportation + lifestyle;
            const taxes = (totalRevenue * taxRate) / 100;
            const reinvestmentAmount = (totalRevenue * reinvestmentRate) / 100;
            
            // Monthly profit/loss
            const monthlyProfit = totalRevenue - totalBusinessExpenses - totalPersonalExpenses - taxes - savings - reinvestmentAmount;
            
            // Break-even point
            const breakeven = totalBusinessExpenses + totalPersonalExpenses + taxes + savings;
            
            // Cash runway (months until $0)
            let runway = 0;
            if (monthlyProfit < 0) {
                runway = Math.abs(cashReserves / monthlyProfit);
            } else {
                runway = Infinity;
            }
            
            // Yearly projection
            const yearlyProfit = monthlyProfit * 12;

            // Update Dashboard
            updateMetric('monthlyProfit', monthlyProfit, true);
            updateMetric('breakeven', breakeven, false);
            updateMetric('yearlyProfit', yearlyProfit, true);
            
            if (runway === Infinity) {
                document.getElementById('runway').textContent = '‚àû';
            } else {
                document.getElementById('runway').textContent = runway.toFixed(1) + ' mo';
            }

            // Update card colors
            updateCardColor('profitCard', monthlyProfit);
            updateCardColor('runwayCard', runway, true);

            // Calculate scores
            calculateScores(monthlyProfit, runway, totalRevenue, totalBusinessExpenses, lifestyle, cashReserves);

            // Update chart
            updateChart(monthlyProfit, cashReserves);
        }

        // Update Metric with Animation
        function updateMetric(id, value, isCurrency) {
            const element = document.getElementById(id);
            const formatted = isCurrency ? formatCurrency(value) : formatCurrency(value);
            element.textContent = formatted;
        }

        // Format Currency
        function formatCurrency(value) {
            if (value >= 0) {
                return '$' + value.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            } else {
                return '-$' + Math.abs(value).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }
        }

        // Update Card Color Based on Value
        function updateCardColor(cardId, value, isRunway = false) {
            const card = document.getElementById(cardId);
            card.classList.remove('positive', 'negative', 'warning');
            
            if (isRunway) {
                if (value < 3) {
                    card.classList.add('negative');
                } else if (value < 6) {
                    card.classList.add('warning');
                } else {
                    card.classList.add('positive');
                }
            } else {
                if (value > 0) {
                    card.classList.add('positive');
                } else if (value < 0) {
                    card.classList.add('negative');
                } else {
                    card.classList.add('warning');
                }
            }
        }

        // Calculate Scores
        function calculateScores(profit, runway, revenue, expenses, lifestyle, reserves) {
            // Stability Score: Based on runway and reserves
            let stabilityScore = 0;
            if (runway > 12) stabilityScore = 100;
            else if (runway > 6) stabilityScore = 75;
            else if (runway > 3) stabilityScore = 50;
            else stabilityScore = 25;
            
            // Growth Score: Based on reinvestment and profit margin
            const profitMargin = (profit / revenue) * 100;
            let growthScore = Math.min(100, profitMargin * 2 + (reserves / 1000));
            
            // Efficiency Score: Revenue vs expenses
            const efficiency = ((revenue - expenses) / revenue) * 100;
            let efficiencyScore = Math.max(0, Math.min(100, efficiency));
            
            // Lifestyle Affordability: Can they afford their lifestyle?
            const lifestyleAffordability = (profit / lifestyle) * 100;
            let lifestyleScore = Math.max(0, Math.min(100, lifestyleAffordability));

            // Update UI
            updateScore('stabilityScore', stabilityScore);
            updateScore('growthScore', growthScore);
            updateScore('efficiencyScore', efficiencyScore);
            updateScore('lifestyleScore', lifestyleScore);
        }

        // Update Score Bar
        function updateScore(id, score) {
            const element = document.getElementById(id);
            element.style.width = score + '%';
            element.textContent = Math.round(score) + '%';
            
            // Change color based on score
            if (score >= 75) {
                element.style.background = 'linear-gradient(90deg, #56ab2f 0%, #a8e063 100%)';
            } else if (score >= 50) {
                element.style.background = 'linear-gradient(90deg, #f093fb 0%, #f5576c 100%)';
            } else {
                element.style.background = 'linear-gradient(90deg, #eb3349 0%, #f45c43 100%)';
            }
        }

        // Update Chart
        let cashflowChart = null;
        function updateChart(monthlyProfit, startingCash) {
            const ctx = document.getElementById('cashflowChart').getContext('2d');
            
            // Generate 12-month projection
            const months = ['Mo 1', 'Mo 2', 'Mo 3', 'Mo 4', 'Mo 5', 'Mo 6', 'Mo 7', 'Mo 8', 'Mo 9', 'Mo 10', 'Mo 11', 'Mo 12'];
            const cashData = [];
            let runningCash = startingCash;
            
            for (let i = 0; i < 12; i++) {
                runningCash += monthlyProfit;
                cashData.push(runningCash);
            }

            if (cashflowChart) {
                cashflowChart.destroy();
            }

            cashflowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Projected Cash Balance',
                        data: cashData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load Scenario (Game Mode)
        function loadScenario() {
            const scenario = scenarios[scenarioIndex % scenarios.length];
            document.getElementById('scenarioText').innerHTML = `
                <strong>${scenario.title}</strong><br><br>
                ${scenario.text}<br><br>
                <em style="color:#92400e;">üí° ${scenario.impact}</em>
            `;
        }

        // Next Scenario
        function nextScenario() {
            scenarioIndex++;
            loadScenario();
        }

        // Reset Simulator
        function resetSimulator() {
            document.getElementById('primaryRevenue').value = 5000;
            document.getElementById('secondaryRevenue').value = 0;
            document.getElementById('fixedCosts').value = 1000;
            document.getElementById('variableCosts').value = 500;
            document.getElementById('payroll').value = 0;
            document.getElementById('debtPayments').value = 0;
            document.getElementById('housing').value = 1500;
            document.getElementById('food').value = 600;
            document.getElementById('transportation').value = 300;
            document.getElementById('lifestyle').value = 400;
            document.getElementById('taxRate').value = 25;
            document.getElementById('savings').value = 500;
            document.getElementById('reinvestment').value = 20;
            document.getElementById('cashReserves').value = 10000;
            
            updateLifestyleValue();
            updateTaxValue();
            updateReinvestmentValue();
            calculate();
        }

        // Initialize on load
        window.onload = function() {
            calculate();
            updateLifestyleValue();
            updateTaxValue();
            updateReinvestmentValue();
        };
    </script>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
